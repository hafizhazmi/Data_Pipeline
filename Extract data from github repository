import requests
import datetime
import os

import requests
import datetime

repository_owner = 'MoH-Malaysia'
repository_name = 'data-darah-public'
api_url = f'https://api.github.com/repos/{repository_owner}/{repository_name}/contents'

token = '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'

output_directory = r'C:\Users\User\Desktop\datadarah'

today = datetime.datetime.today().strftime('%Y-%m-%d')
output_directory_today = f'{output_directory}/{today}'
os.makedirs(output_directory_today, exist_ok=True)

response = requests.get(api_url, headers={'Authorization': f'token {token}'})

if response.status_code == 200:
    data = response.json()

    for item in data:
        file_url = item['download_url']
        file_name = f"{output_directory_today}/{item['name']}"

        with open(file_name, 'wb') as file:
            file_content = requests.get(file_url).content
            file.write(file_content)

    print(f'Data extracted successfully on {today}')
else:
    print(f'Error: {response.status_code}')
